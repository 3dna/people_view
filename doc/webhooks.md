Webhooks
========

Webhooks are a way to interact with an application by telling it to tell your services about certain events as they occur.

For example, MailChimp offers webhook functionality, so you can perhaps have MailChimp to tell your servers when a person unsubscribes from your mailing list.

This is the list of webhook events that NationBuilder supports:

* Donation success
* Donation update
* Donation cancellation
* Person creation
* Person update
* Person contact

In order to determine whether to trust a request your server receives, you can attach a shared secret token to your nation which will be attached to the payload via the key `token`.  For this to be effective, make sure that your webhook recipient application uses HTTPS to communicate.

Subnations
----------

Nations with subnations can register webhooks for events that happen in their subnations.  These requests will be accompanied by the webhook token belonging to the parent nation.

Samples
-------

### Person Creation/Update

```
POST http://www.example.com/webhook

{
  "token": "sharedsecret",
  "payload": {
    "signup": {
      "nationbuilder_id": 65536,
      "twitter_id": null,
      "twitter_login": null,
      "meetup_id": null,
      "civicrm_id": null,
      "external_id": null,
      "salesforce_id": null,
      "prefix": null,
      "first_name": "John",
      "middle_name": null,
      "last_name": "Doe",
      "suffix": null,
      "full_name": "John Doe",
      "legal_name": null,
      "employer": null,
      "occupation": null,
      "sex": null,
      "party": null,
      "religion": null,
      "church": null,
      "ethnicity": null,
      "marital_status": null,
      "website": null,
      "language": null,
      "is_deceased": false,
      "born_at": null,
      "email1": "person@example.com",
      "email2": null,
      "email3": null,
      "email4": null,
      "email_opt_in": true,
      "phone_number": null,
      "work_phone_number": null,
      "do_not_call": false,
      "do_not_contact": false,
      "federal_donotcall": false,
      "mobile_number": null,
      "mobile_opt_in": true,
      "is_mobile_bad": false,
      "fax_number": null,
      "household_size": null,
      "demo": null,
      "support_level": null,
      "inferred_support_level": null,
      "priority_level": null,
      "availability": null,
      "note": null,
      "parent_id": null,
      "point_person_name_or_email": null,
      "recruiter_id": null,
      "recruiter_name_or_email": null,
      "tag_list": "donor",
      "created_at": "02\/01\/2013  3:54 PM",
      "unsubscribed_at": null,
      "is_supporter": true,
      "is_prospect": false,
      "is_volunteer": false,
      "is_donor": null,
      "is_fundraiser": false,
      "is_ignore_donation_limits": false,
      "first_donated_at": null,
      "last_donated_at": null,
      "donations_count": 0,
      "donations_amount": "$0.00",
      "donations_amount_in_cents": 0,
      "donations_raised_count": 0,
      "donations_raised_amount": "$0.00",
      "donations_raised_amount_in_cents": 0,
      "donations_pledged_amount": "$0.00",
      "donations_pledged_amount_in_cents": 0,
      "donations_count_this_cycle": 0,
      "donations_amount_this_cycle": "$0.00",
      "donations_amount_this_cycle_in_cents": 0,
      "donations_raised_count_this_cycle": 0,
      "donations_raised_amount_this_cycle": "$0.00",
      "donations_raised_amount_this_cycle_in_cents": 0,
      "maximum_donation_possible_this_cycle": "$0.00",
      "maximum_donation_possible_this_cycle_in_cents": 0,
      "membership_level_name": null,
      "membership_started_at": null,
      "membership_expires_at": null,
      "assistant_first_name": null,
      "assistant_last_name": null,
      "assistant_email": null,
      "assistant_phone": null,
      "assistant_mobile": null,
      "assistant_work_phone": null,
      "nbec_guid": null,
      "pf_strat_id": null,
      "state_file_id": null,
      "county_file_id": null,
      "dw_id": null,
      "van_id": null,
      "ngp_id": null,
      "pf_matchkey": null,
      "previous_party": null,
      "inferred_party": null,
      "federal_district": null,
      "state_upper_district": null,
      "state_lower_district": null,
      "county_district": null,
      "city_district": null,
      "village_district": null,
      "judicial_district": null,
      "school_district": null,
      "school_sub_district": null,
      "fire_district": null,
      "precinct_name": null,
      "precinct_code": null,
      "media_market_name": null,
      "support_probability_score": null,
      "turnout_probability_score": null,
      "capital_amount": null,
      "capital_amount_in_cents": 500,
      "spent_capital_amount": null,
      "spent_capital_amount_in_cents": 0,
      "received_capital_amount": null,
      "received_capital_amount_in_cents": 500
    }
  }
}
```

### Donation Success/Update/Cancel

```
POST https://www.example.com/webhook

{
  "token": "sharedsecret",
  "payload": {
    "donation": {
      "donation_nationbuilder_id": 1,
      "amount": "$20.20",
      "amount_in_cents": 2020,
      "authorization": null,
      "ngp_id": null,
      "actblue_order_number": null,
      "election_cycle": null,
      "election_period_ngp_code": null,
      "election_period_name": null,
      "election_period_id": null,
      "payment_type_ngp_code": "C",
      "payment_type_name": "Cash",
      "payment_type_id": 1,
      "fec_type_ngp_code": null,
      "fec_type_name": null,
      "fec_type_id": null,
      "check_number": null,
      "currency": null,
      "succeeded_at": null,
      "failed_at": null,
      "canceled_at": null,
      "created_at": "05\/30\/2013 12:51 AM",
      "is_private": false,
      "ip_address": null,
      "note": null,
      "page_slug": null,
      "recruiter_id": 75408,
      "recruiter_name": "Jake Doe",
      "tracking_code_slug": null,
      "merchant_account_name": null,
      "is_corporate_contribution": false,
      "signup": {
        "nationbuilder_id": 75408,
        "twitter_id": null,
        "twitter_login": null,
        "meetup_id": null,
        "civicrm_id": null,
        "external_id": null,
        "salesforce_id": null,
        "prefix": null,
        "first_name": "Joe",
        "middle_name": null,
        "last_name": "Doe",
        "suffix": null,
        "full_name": "Joe Doe",
        "legal_name": null,
        "employer": null,
        "occupation": null,
        "sex": null,
        "party": null,
        "religion": null,
        "church": null,
        "ethnicity": null,
        "marital_status": null,
        "website": null,
        "language": null,
        "is_deceased": false,
        "born_at": "05\/14\/1942",
        "email1": "joe@example.com",
        "email2": null,
        "email3": null,
        "email4": null,
        "email_opt_in": true,
        "phone_number": null,
        "work_phone_number": null,
        "do_not_call": false,
        "do_not_contact": false,
        "federal_donotcall": false,
        "mobile_number": null,
        "mobile_opt_in": true,
        "is_mobile_bad": false,
        "fax_number": null,
        "household_size": null,
        "demo": null,
        "support_level": null,
        "inferred_support_level": null,
        "priority_level": null,
        "availability": null,
        "note": null,
        "parent_id": null,
        "point_person_name_or_email": null,
        "recruiter_id": 75408,
        "recruiter_name_or_email": "Jake Doe",
        "tag_list": "",
        "created_at": "05\/28\/2013  3:37 PM",
        "unsubscribed_at": null,
        "is_supporter": true,
        "is_prospect": false,
        "is_volunteer": false,
        "is_donor": null,
        "is_fundraiser": true,
        "is_ignore_donation_limits": false,
        "first_donated_at": "12\/31\/2012  7:00 PM",
        "last_donated_at": "05\/27\/2013  8:00 PM",
        "donations_count": 2,
        "donations_amount": "$40.40",
        "donations_amount_in_cents": 4040,
        "donations_raised_count": 2,
        "donations_raised_amount": "$40.40",
        "donations_raised_amount_in_cents": 4040,
        "donations_pledged_amount": "$0.00",
        "donations_pledged_amount_in_cents": 0,
        "donations_count_this_cycle": 0,
        "donations_amount_this_cycle": "$0.00",
        "donations_amount_this_cycle_in_cents": 0,
        "donations_raised_count_this_cycle": 2,
        "donations_raised_amount_this_cycle": "$40.40",
        "donations_raised_amount_this_cycle_in_cents": 4040,
        "maximum_donation_possible_this_cycle": "$0.00",
        "maximum_donation_possible_this_cycle_in_cents": 0,
        "membership_level_name": null,
        "membership_started_at": null,
        "membership_expires_at": null,
        "assistant_first_name": null,
        "assistant_last_name": null,
        "assistant_email": null,
        "assistant_phone": null,
        "assistant_mobile": null,
        "assistant_work_phone": null,
        "nbec_guid": null,
        "pf_strat_id": null,
        "state_file_id": null,
        "county_file_id": null,
        "dw_id": null,
        "van_id": null,
        "ngp_id": null,
        "pf_matchkey": null,
        "previous_party": null,
        "inferred_party": null,
        "federal_district": null,
        "state_upper_district": null,
        "state_lower_district": null,
        "county_district": null,
        "city_district": null,
        "village_district": null,
        "judicial_district": null,
        "school_district": null,
        "school_sub_district": null,
        "fire_district": null,
        "precinct_name": null,
        "precinct_code": null,
        "media_market_name": null,
        "support_probability_score": null,
        "turnout_probability_score": null,
        "capital_amount": null,
        "capital_amount_in_cents": 500,
        "spent_capital_amount": null,
        "spent_capital_amount_in_cents": 0,
        "received_capital_amount": null,
        "received_capital_amount_in_cents": 500,
        "address": {
          "country_code": null,
          "country": null,
          "state": "CA",
          "city": "Pasadena",
          "county": null,
          "zip": "91101",
          "address1": "123 Fake St",
          "address2": null,
          "address3": null,
          "fips": null
        }
      }
    }
  }
}
```
